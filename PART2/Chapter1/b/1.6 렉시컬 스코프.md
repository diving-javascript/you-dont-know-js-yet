# 1. 스코프

## 1.6 렉시컬 스코프 (Lexical Scope)

렉시컬 스코프는 자바스크립트의 스코프가 컴파일 시에 결정된다는 것을 의미합니다. 

### **1. 렉시컬 스코프란?**

렉시컬 스코프는 컴파일 단계에서 변수와 함수의 스코프가 결정되며, 이 스코프는 코드의 작성 위치에 따라 결정됩니다. "렉시컬"이라는 용어는 컴파일 과정의 "렉싱(Lexing)" 단계와 관련이 있습니다.

#### **렉싱(Lexing) 정의**

렉싱(Lexing)은 컴파일러가 소스 코드를 처리하는 초기 단계로, 입력된 코드 문자열을 의미 있는 단위인 토큰(token)으로 분해하는 과정입니다. 이 단계는 "토큰화(Tokenizing)"라고도 불립니다.

#### **렉싱 단계의 과정**

1. **문자열 입력**: 프로그램의 소스 코드 문자열을 입력으로 받습니다.
2. **토큰화(Tokenizing)**: 코드 문자열을 의미 있는 단위인 토큰으로 분해합니다.
3. **토큰 생성**: 각 토큰을 키워드, 식별자, 연산자, 리터럴 등으로 분류합니다.

#### **예제 코드**

```javascript
var greeting = "Hello, World!";
```

위 코드는 렉싱 단계를 거쳐 다음과 같은 토큰으로 분해됩니다:

- `var` (키워드)
- `greeting` (식별자)
- `=` (연산자)
- `"Hello, World!"` (문자열 리터럴)
- `;` (구문 종료)

#### **토큰화 과정**

1. **문자열 읽기**: 코드 문자열을 읽습니다.
2. **토큰 식별**: 문자열을 읽으면서 다음과 같이 토큰을 식별합니다:
    - `var`를 키워드로 식별
    - `greeting`을 식별자로 식별
    - `=`를 연산자로 식별
    - `"Hello, World!"`를 문자열 리터럴로 식별
    - `;`를 구문 종료 토큰으로 식별

#### **렉싱과 구문 분석(Parsing)의 차이**

- **렉싱(Lexing)**: 코드 문자열을 개별 토큰으로 분해합니다.
- **구문 분석(Parsing)**: 토큰을 사용하여 프로그램의 문법 구조를 나타내는 구문 트리(AST)를 생성합니다.

### **2. 함수와 변수 선언의 위치에 따른 스코프 결정**

#### **함수 내 변수 선언**

함수 내에 선언된 변수는 해당 함수의 스코프에 속합니다. 

```javascript
function example() {
    var message = "Hello, World!";
    console.log(message); // "Hello, World!"
}

example();
// console.log(message); // ReferenceError: message is not defined
```

여기서 `message` 변수는 `example` 함수의 스코프에 속하므로 함수 외부에서는 접근할 수 없습니다.

#### **블록 스코프 변수 선언**

`let`과 `const`로 선언된 변수는 블록 스코프를 가집니다.

```javascript
function example() {
    if (true) {
        let message = "Hello, Block!";
        console.log(message); // "Hello, Block!"
    }
    // console.log(message); // ReferenceError: message is not defined
}

example();
```

`message` 변수는 `if` 블록 내에 선언되었으므로 블록 외부에서는 접근할 수 없습니다.

### **3. 변수 참조의 해결**

변수 참조는 렉시컬하게 접근할 수 있는 스코프 중 하나에서 해결됩니다. 

```javascript
var globalVar = "Global";

function outer() {
    var outerVar = "Outer";

    function inner() {
        var innerVar = "Inner";
        console.log(innerVar); // "Inner"
        console.log(outerVar); // "Outer"
        console.log(globalVar); // "Global"
    }

    inner();
}

outer();
```

- `inner` 함수는 `innerVar`, `outerVar`, `globalVar` 변수를 참조할 수 있습니다.
- `innerVar`는 `inner` 함수 내부에서만 접근할 수 있습니다.
- `outerVar`는 `outer` 함수 스코프에서 정의되었지만, `inner` 함수에서도 접근할 수 있습니다.
- `globalVar`는 전역 스코프에서 정의되었으며, 모든 함수에서 접근할 수 있습니다.

### **4. 컴파일과 런타임의 차이**

#### **컴파일 과정의 역할**

컴파일 과정은 소스 코드를 분석하고, 실행을 준비하는 단계입니다. 이 과정에서 중요한 점은 **실제로 스코프와 변수에 대한 메모리를 예약하지 않는다는 것**입니다. 대신, 컴파일 과정은 프로그램 실행에 필요한 모든 **렉시컬 스코프의 지도를 생성**합니다.

#### **렉시컬 스코프의 지도 생성**

컴파일 과정에서 생성되는 렉시컬 스코프의 지도는 프로그램이 실행될 때 참조할 수 있도록 모든 스코프와 변수를 체계적으로 정리한 것입니다. 이는 다음과 같은 과정을 포함합니다:

1. **소스 코드 분석**:
    - 코드의 구조를 분석하여 함수, 블록, 변수 선언을 식별합니다.
    - 예를 들어, 함수 내에 선언된 변수와 블록 스코프 변수를 각각의 스코프에 연결합니다.

2. **스코프 체계화**:
    - 각 스코프에 포함된 변수와 함수 선언을 체계적으로 정리합니다.
    - 예를 들어, 함수 스코프와 블록 스코프를 구분하고, 각 스코프에 속하는 변수를 식별합니다.

3. **스코프 간 연결 설정**:
    - 내부 스코프와 외부 스코프 간의 연결 관계를 설정합니다.
    - 예를 들어, 내부 함수에서 외부 함수의 변수를 참조할 수 있도록 스코프 간의 연결을 설정합니다.

#### **예제 코드**

다음은 컴파일 과정에서 렉시컬 스코프의 지도가 어떻게 생성되는지 설명하는 예제 코드입니다:

```javascript
function outer() {
    var outerVar = "I am outer";

    function inner() {
        var innerVar = "I am inner";
        console.log(outerVar); // "I am outer"
    }

    inner();
}

outer();
```

1. **소스 코드 분석**:
    - `outer` 함수와 `inner` 함수가 식별됩니다.
    - `outer` 함수의 스코프에 `outerVar` 변수가 포함됩니다.
    - `inner` 함수의 스코프에 `innerVar` 변수가 포함됩니다.

2. **스코프 체계화**:
    - `outer` 함수 스코프와 `inner` 함수 스코프가 각각 설정됩니다.
    - `outer` 함수 스코프에는 `outerVar`가 포함되고, `inner` 함수 스코프에는 `innerVar`가 포함됩니다.

3. **스코프 간 연결 설정**:
    - `inner` 함수 스코프에서 `outer` 함수 스코프로의 참조가 설정됩니다.
    - `inner` 함수는 `outerVar`를 참조할 수 있습니다.

#### **실행 시점의 메모리 예약**

실제로 메모리가 예약되는 시점은 프로그램이 실행될 때입니다. 즉, 컴파일 과정에서는 메모리 예약 없이, 프로그램 실행 시점에 필요한 스코프와 변수의 지도를 준비합니다.

- **컴파일 시**: 렉시컬 스코프의 지도가 생성되고, 변수와 함수의 위치가 정해집니다.
- **실행 시**: 컴파일 과정에서 생성된 지도를 참조하여 실제로 메모리가 할당되고, 변수와 함수가 실행됩니다.

### **5. 중요한 점**

- 스코프는 컴파일 시에 식별되지만, 실제로는 런타임에 필요할 때마다 생성됩니다.
- 각 스코프는 실행될 때마다 생성됩니다.

### **6. 다음 장의 예고**

다음 장에서는 렉시컬 스코프의 개념적 기초를 더 자세히 설명하고, 이를 통해 렉시컬 스코프의 작동 방식을 더 잘 이해할 수 있도록 하겠습니다. 
